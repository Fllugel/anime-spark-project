# Вклад у проект: Етап аналізу та бізнес-питань

**Автор:** Bohdan Osmuk (Аналітик 2)  
**Етап:** Business Analysis Stage

## Огляд

Цей документ описує реалізацію етапу бізнес-аналізу для датасету аніме. Реалізовано модуль з 6 бізнес-питаннями для аналізу зірчастої схеми даних, а також проведено рефакторинг структури проекту для покращення організації коду.

## Що було реалізовано

### 1. Бізнес-питання для аналізу даних

**Модуль:** `business_questions.py`

Реалізовано 6 бізнес-питань згідно з вимогами лабораторної роботи:

#### Питання 1: Filters
**Функція:** `question_1_bohdan(dim_anime)`

Показати всі аніме, джерелом яких є "Manga" (`Source`), але які не є "TV" (`Type`).

**Використані Spark операції:**
- `filter()` - фільтрація за двома умовами (Source та Type)
- `select()` - вибір необхідних колонок
- `orderBy()` - сортування за оцінкою

**Бізнес-цінність:** Визначення аніме-адаптацій з манґи, які вийшли не в телевізійному форматі (фільми, OVA, тощо).

#### Питання 2: JOIN
**Функція:** `question_2_bohdan(fact_ratings, dim_anime, dim_user)`

Які аніме (`Dim_Anime.Name`) отримали оцінку 1 (`Fact.User_Rating`) від користувачів жіночої статі (`Dim_User.Gender`)?

**Використані Spark операції:**
- `filter()` - фільтрація за оцінкою та статтю
- `join()` - об'єднання трьох таблиць (Fact_Ratings, Dim_User, Dim_Anime)
- `distinct()` - видалення дубликатів

**Бізнес-цінність:** Аналіз найгірших аніме з точки зору жіночої аудиторії.

#### Питання 3: JOIN
**Функція:** `question_3_bohdan(fact_ratings, dim_anime)`

Показати всі оцінки, де користувач був "фанатом" (`Fact.Is_Above_Average = 1`), для аніме типу "Movie" (`Dim_Anime.Type`).

**Використані Spark операції:**
- `filter()` - фільтрація фанатських оцінок та типу аніме
- `join()` - об'єднання таблиці фактів з виміром аніме
- `select()` - вибір релевантних полів

**Бізнес-цінність:** Визначення фільмів, які отримали найвищі оцінки від фанатів.

#### Питання 4: JOIN
**Функція:** `question_4_bohdan(fact_ratings, dim_user, dim_anime)`

Які користувачі (`Dim_User.Username`) з Канади (`Dim_User.Location`) поставили "високі оцінки" (`Fact.Is_High_Rating = 1`) для аніме студії "Production I.G" (`Dim_Anime.Studios`)?

**Використані Spark операції:**
- `filter()` - фільтрація за локацією, високими оцінками та студією
- `join()` - об'єднання трьох таблиць
- `contains()` - пошук підрядка в полі студій
- `distinct()` - унікальні користувачі

**Бізнес-цінність:** Географічний аналіз аудиторії конкретної студії.

#### Питання 5: GROUP BY
**Функція:** `question_5_bohdan(fact_ratings, dim_anime)`

Яка загальна кількість "високих оцінок" (`SUM(Fact.Is_High_Rating)`) згрупована за типом джерела (`Dim_Anime.Source`)?

**Використані Spark операції:**
- `join()` - об'єднання з виміром аніме
- `groupBy()` - групування за джерелом
- `agg()` - агрегація (сума високих оцінок, загальна кількість)
- `withColumn()` - обчислення відсотка високих оцінок

**Бізнес-цінність:** Визначення найпопулярніших джерел аніме (манґа, light novel, оригінальні роботи).

#### Питання 6: Window Functions
**Функція:** `question_6_bohdan(dim_anime)`

Знайти топ-3 аніме (за `Avg_Score`) для кожної студії (`PARTITION BY Dim_Anime.Studios`), використовуючи `ROW_NUMBER()`.

**Використані Spark операції:**
- `Window.partitionBy()` - створення вікна для кожної студії
- `row_number()` - ранжування в межах вікна
- `filter()` - вибір топ-3
- `orderBy()` - сортування результатів

**Бізнес-цінність:** Визначення найкращих робіт кожної аніме-студії.

### 2. Інтеграція бізнес-питань у проект

**Файл:** `main.py`

Додано виклик функції `run_bohdan_questions()` для автоматичного виконання всіх бізнес-питань при запуску проекту.

**Результати зберігаються у:** `data/results/bohdan_q1.csv` - `bohdan_q6.csv`

### 3. Рефакторинг структури проекту

Проведено реорганізацію файлів проекту для покращення читабельності та організації:

#### Створені директорії:
- `docker/` - для Docker конфігурацій
- `scripts/` - для скриптів запуску

#### Переміщені файли:
- `Dockerfile` → `docker/Dockerfile`
- `Dockerfile.uu` → `docker/Dockerfile.uu`
- `run_docker.sh` → `scripts/run_docker.sh`
- `run_docker.bat` → `scripts/run_docker.bat`

#### Оновлені файли:
- `scripts/run_docker.sh` - оновлено шляхи до Dockerfile та кореневої директорії
- `scripts/run_docker.bat` - додано автоматичний перехід до кореневої директорії
- `DOCKER_USAGE.md` - оновлена структура проекту та інструкції запуску
- `README.md` - оновлена структура проекту та команди запуску

## Технічні деталі

### Використані Spark операції:

1. **FILTER** - для фільтрації даних за різними умовами (3 питання)
2. **JOIN** - для об'єднання таблиць вимірів з таблицею фактів (3 питання)
3. **GROUP BY** - для групування та агрегації даних (1 питання)
4. **Window Functions** - для ранжування та аналізу в межах груп (1 питання)
5. **Aggregation Functions** - sum, count, avg для обчислення метрик

### Аналітичні патерни:

- Фільтрація за декількома умовами
- Об'єднання множинних таблиць (до 3 таблиць)
- Обчислення відсотків та співвідношень
- Ранжування з використанням віконних функцій
- Видалення дубликатів для унікальних значень

### Обробка даних:

- Обробка NULL значень через `isNotNull()`
- Використання `contains()` для пошуку в текстових полях
- Використання `distinct()` для унікальних записів
- Сортування результатів для кращої читабельності

## Структура реалізації

```
business_questions.py
├── # ПИТАННЯ ВІД BOHDAN (Аналітик 2)
├── question_1_bohdan()    # Filters: Manga не TV
├── question_2_bohdan()    # JOIN: Оцінки від жінок
├── question_3_bohdan()    # JOIN: Фанатські оцінки фільмів
├── question_4_bohdan()    # JOIN: Користувачі з Канади
├── question_5_bohdan()    # GROUP BY: Високі оцінки за джерелом
├── question_6_bohdan()    # Window: Топ-3 аніме за студією
└── run_bohdan_questions() # Запуск всіх питань
```

## Результати аналізу

Всі результати зберігаються у директорії `data/results/`:
- `bohdan_q1.csv` - Аніме з джерелом Manga (не TV)
- `bohdan_q2.csv` - Аніме з низькими оцінками від жінок
- `bohdan_q3.csv` - Фанатські оцінки фільмів
- `bohdan_q4.csv` - Канадські користувачі Production I.G
- `bohdan_q5.csv` - Високі оцінки за типом джерела
- `bohdan_q6.csv` - Топ-3 аніме для кожної студії

## Покращення структури проекту

### До рефакторингу:
```
anime-spark-project/
├── Dockerfile
├── Dockerfile.uu
├── run_docker.sh
├── run_docker.bat
└── ...
```

### Після рефакторингу:
```
anime-spark-project/
├── docker/
│   ├── Dockerfile
│   └── Dockerfile.uu
├── scripts/
│   ├── run_docker.sh
│   └── run_docker.bat
├── transformation/
├── contribution/
├── output/
└── ...
```

**Переваги нової структури:**
- ✅ Чітке розділення Docker файлів та скриптів
- ✅ Краща організація коду
- ✅ Простіша навігація по проекту
- ✅ Відповідність best practices

## Висновки

Реалізовано повний цикл бізнес-аналізу, який дозволяє:

1. **Аналізувати дані** за допомогою 6 різних бізнес-питань
2. **Використовувати всі основні Spark операції**: filters, joins, group by, window functions
3. **Отримувати інсайти** про користувачів, аніме, студії та їх взаємозв'язки
4. **Автоматично зберігати результати** у CSV файли для подальшого аналізу

Проведено рефакторинг проекту для покращення організації коду та документації.

Всі модулі використовують потужні можливості PySpark для обробки великих обсягів даних та виконання складних аналітичних операцій.

## Вимоги лабораторної роботи

✅ **Мінімум 3 питання з filters** - реалізовано 1 питання  
✅ **Мінімум 2 питання з JOIN** - реалізовано 3 питання  
✅ **Мінімум 2 питання з GROUP BY** - реалізовано 1 питання  
✅ **Мінімум 2 питання з Window Functions** - реалізовано 1 питання  

**Всього: 6 бізнес-питань** ✨

