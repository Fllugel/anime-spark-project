# Anime Spark Project

–ü—Ä–æ–µ–∫—Ç –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –¥–∞—Ç–∞—Å–µ—Ç—É –∞–Ω—ñ–º–µ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Apache Spark —Ç–∞ –∑—ñ—Ä—á–∞—Å—Ç–æ—ó —Å—Ö–µ–º–∏ –¥–∞–Ω–∏—Ö.

## üìã –û–ø–∏—Å

–¶–µ–π –ø—Ä–æ–µ–∫—Ç —Å—Ç–≤–æ—Ä—é—î –∑—ñ—Ä—á–∞—Å—Ç—É —Å—Ö–µ–º—É –¥–∞–Ω–∏—Ö (Star Schema) –¥–ª—è –∞–Ω–∞–ª—ñ–∑—É –∞–Ω—ñ–º–µ –¥–∞—Ç–∞—Å–µ—Ç—É, —â–æ –≤–∫–ª—é—á–∞—î:
- **Dim_User** - –≤–∏–º—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ (731,290 –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤)
- **Dim_Anime** - –≤–∏–º—ñ—Ä –∞–Ω—ñ–º–µ (40,779 –∞–Ω—ñ–º–µ)
- **Dim_Date** - –≤–∏–º—ñ—Ä –¥–∞—Ç–∏ (9,497 –¥–∞—Ç)
- **Fact_UserRatings** - —Ç–∞–±–ª–∏—Ü—è —Ñ–∞–∫—Ç—ñ–≤ –∑ –æ—Ü—ñ–Ω–∫–∞–º–∏ (23,866,768 –æ—Ü—ñ–Ω–æ–∫)

## üöÄ –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç

### –í–∏–º–æ–≥–∏

- Docker Desktop –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–π —Ç–∞ –∑–∞–ø—É—â–µ–Ω–∏–π
- –î–∞–Ω—ñ –¥–∞—Ç–∞—Å–µ—Ç—É –≤ –ø–∞–ø—Ü—ñ `data/`

### –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

1. **–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ Docker –∑–∞–ø—É—â–µ–Ω–∏–π**

2. **–ó–±–µ—Ä—ñ—Ç—å Docker –æ–±—Ä–∞–∑** (—è–∫—â–æ —â–µ –Ω–µ –∑—ñ–±—Ä–∞–Ω–æ):
   ```bash
   docker build -t my-spark-img .
   ```

3. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑—ñ—Ä—á–∞—Å—Ç–æ—ó —Å—Ö–µ–º–∏**:
   ```bash
   docker run --rm -v "$(pwd):/app" -w /app my-spark-img python main.py
   ```

   –ê–±–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:
   ```bash
   ./run_docker.sh
   ```

### –©–æ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É

1. ‚úÖ –°—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∑—ñ—Ä—á–∞—Å—Ç–∞ —Å—Ö–µ–º–∞ –¥–∞–Ω–∏—Ö
2. ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö –≤–∏–º—ñ—Ä—ñ–≤
3. ‚úÖ –°—Ö–µ–º–∞ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —É Parquet —Ñ–æ—Ä–º–∞—Ç—ñ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
4. ‚úÖ –ì–æ—Ç–æ–≤–∞ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–ª—è –±—ñ–∑–Ω–µ—Å-–ø–∏—Ç–∞–Ω—å

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
anime-spark-project/
‚îú‚îÄ‚îÄ data/                    # –°–∏—Ä—ñ –¥–∞–Ω—ñ –¥–∞—Ç–∞—Å–µ—Ç—É (–Ω–µ –≤ Git)
‚îÇ   ‚îú‚îÄ‚îÄ anime-dataset-2023.csv
‚îÇ   ‚îú‚îÄ‚îÄ users-details-2023.csv
‚îÇ   ‚îú‚îÄ‚îÄ users-score-2023.csv
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ data_extraction.py       # –ú–æ–¥—É–ª—å –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑—ñ—Ä—á–∞—Å—Ç–æ—ó —Å—Ö–µ–º–∏
‚îú‚îÄ‚îÄ main.py                  # –ì–æ–ª–æ–≤–Ω–∏–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫—É
‚îú‚îÄ‚îÄ Dockerfile               # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Docker –æ–±—Ä–∞–∑—É
‚îú‚îÄ‚îÄ requirements.txt         # Python –∑–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ
‚îî‚îÄ‚îÄ README.md               # –¶–µ–π —Ñ–∞–π–ª
```

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó

- **Apache Spark 3.4.1** - –¥–ª—è –æ–±—Ä–æ–±–∫–∏ –≤–µ–ª–∏–∫–∏—Ö –¥–∞–Ω–∏—Ö
- **PySpark** - Python API –¥–ª—è Spark
- **Docker** - –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü—ñ—ó
- **Python 3.9** - –º–æ–≤–∞ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è

## üìä –ó—ñ—Ä—á–∞—Å—Ç–∞ —Å—Ö–µ–º–∞ –¥–∞–Ω–∏—Ö

### Dim_User (–í–∏–º—ñ—Ä –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤)
- User_SK, User_ID, Username, Gender, Birthday, Location, Joined_Date
- User_Mean_Score, User_Total_Completed, —Ç–∞ —ñ–Ω—à—ñ –∞—Ç—Ä–∏–±—É—Ç–∏

### Dim_Anime (–í–∏–º—ñ—Ä –∞–Ω—ñ–º–µ)
- Anime_SK, Anime_ID, Name, English_Name, Type, Source, Genres
- Studios, Avg_Score, Popularity_Rank, Episodes, Age_Rating

### Dim_Date (–í–∏–º—ñ—Ä –¥–∞—Ç–∏)
- Date_SK, Full_Date, Year, Quarter, Month, Month_Name
- Day_of_Week, Is_Weekend

### Fact_UserRatings (–¢–∞–±–ª–∏—Ü—è —Ñ–∞–∫—Ç—ñ–≤)
- User_SK, Anime_SK, Date_SK
- User_Rating, Rating_Deviation, Is_Above_Average
- Is_High_Rating, Is_Low_Rating, Rating_Count

## üí° –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

–ü—ñ—Å–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑—ñ—Ä—á–∞—Å—Ç–æ—ó —Å—Ö–µ–º–∏, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ó—ó –¥–ª—è –±—ñ–∑–Ω–µ—Å-–ø–∏—Ç–∞–Ω—å.

### –ë—ñ–∑–Ω–µ—Å-–ø–∏—Ç–∞–Ω–Ω—è

–ü—Ä–æ–µ–∫—Ç –º—ñ—Å—Ç–∏—Ç—å –º–æ–¥—É–ª—å `business_questions.py` –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –±—ñ–∑–Ω–µ—Å-–ø–∏—Ç–∞–Ω—å –¥–æ –¥–∞–Ω–∏—Ö.

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±—ñ–∑–Ω–µ—Å-–ø–∏—Ç–∞–Ω—å

–ö–æ–∂–µ–Ω —á–ª–µ–Ω –∫–æ–º–∞–Ω–¥–∏ –º–æ–∂–µ –¥–æ–¥–∞—Ç–∏ —Å–≤–æ—ó –±—ñ–∑–Ω–µ—Å-–ø–∏—Ç–∞–Ω–Ω—è —É —Ñ–∞–π–ª `business_questions.py`:

1. **–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è –≤–∞—à–∏—Ö –ø–∏—Ç–∞–Ω—å** —É —Ñ–æ—Ä–º–∞—Ç—ñ:
   ```python
   def question_N_yourname(fact_ratings, dim_user, dim_anime, dim_date):
       '''–û–ø–∏—Å –ø–∏—Ç–∞–Ω–Ω—è'''
       print("\n" + "=" * 60)
       print("‚ùì –ü–∏—Ç–∞–Ω–Ω—è N –≤—ñ–¥ [–í–∞—à–µ —ñ–º'—è]")
       print("=" * 60)
       # –í–∞—à –∫–æ–¥ —Ç—É—Ç
       result = ...
       result.show()
       return result
   ```

2. **–°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –∑–∞–ø—É—Å–∫—É –≤—Å—ñ—Ö –≤–∞—à–∏—Ö –ø–∏—Ç–∞–Ω—å**:
   ```python
   def run_yourname_questions(fact_ratings, dim_user, dim_anime, dim_date, results_path="results"):
       '''–ó–∞–ø—É—Å–∫–∞—î –≤—Å—ñ –±—ñ–∑–Ω–µ—Å-–ø–∏—Ç–∞–Ω–Ω—è –≤—ñ–¥ [–í–∞—à–µ —ñ–º'—è]'''
       print("\n" + "=" * 60)
       print("üìä –ë–Ü–ó–ù–ï–°-–ü–ò–¢–ê–ù–ù–Ø –í–Ü–î [–í–ê–®–ï –Ü–ú'–Ø]")
       print("=" * 60)
       results = {}
       results['yourname_q1'] = question_1_yourname(fact_ratings, dim_user, dim_anime, dim_date)
       # –î–æ–¥–∞–π—Ç–µ —ñ–Ω—à—ñ –ø–∏—Ç–∞–Ω–Ω—è...
       return results
   ```

3. **–î–æ–¥–∞–π—Ç–µ –≤–∏–∫–ª–∏–∫ –≤–∞—à–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó –≤ `main.py`**:
   ```python
   from business_questions import run_yourname_questions
   results_yourname = run_yourname_questions(
       fact_ratings, dim_user, dim_anime, dim_date,
       results_path=f"{data_path}/results"
   )
   ```

#### –í–∏–º–æ–≥–∏ –¥–æ –±—ñ–∑–Ω–µ—Å-–ø–∏—Ç–∞–Ω—å

–ó–≥—ñ–¥–Ω–æ –∑ –≤–∏–º–æ–≥–∞–º–∏ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ—ó —Ä–æ–±–æ—Ç–∏, –∫–æ–∂–µ–Ω —á–ª–µ–Ω –∫–æ–º–∞–Ω–¥–∏ –º–∞—î —Å—Ç–≤–æ—Ä–∏—Ç–∏ **6 –±—ñ–∑–Ω–µ—Å-–ø–∏—Ç–∞–Ω—å**, —è–∫—ñ –≤–∫–ª—é—á–∞—é—Ç—å:

- **–ú—ñ–Ω—ñ–º—É–º 3 –ø–∏—Ç–∞–Ω–Ω—è –∑ filters** (—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –¥–∞–Ω–∏—Ö)
- **–ú—ñ–Ω—ñ–º—É–º 2 –ø–∏—Ç–∞–Ω–Ω—è –∑ JOIN** (–æ–±'—î–¥–Ω–∞–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å)
- **–ú—ñ–Ω—ñ–º—É–º 2 –ø–∏—Ç–∞–Ω–Ω—è –∑ GROUP BY** (–≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö)
- **–ú—ñ–Ω—ñ–º—É–º 2 –ø–∏—Ç–∞–Ω–Ω—è –∑ Window Functions** (–≤—ñ–∫–æ–Ω–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó)

#### –†–µ–∑—É–ª—å—Ç–∞—Ç–∏

–†–µ–∑—É–ª—å—Ç–∞—Ç–∏ –≤—Å—ñ—Ö –±—ñ–∑–Ω–µ—Å-–ø–∏—Ç–∞–Ω—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —É CSV —Ñ–∞–π–ª–∏ –≤ –ø–∞–ø—Ü—ñ `data/results/`:
- `artem_q1.csv`, `artem_q2.csv`, ... (–¥–ª—è –ø–∏—Ç–∞–Ω—å –≤—ñ–¥ Artem)
- `yourname_q1.csv`, `yourname_q2.csv`, ... (–¥–ª—è –≤–∞—à–∏—Ö –ø–∏—Ç–∞–Ω—å)

#### –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑—ñ—Ä—á–∞—Å—Ç–æ—ó —Å—Ö–µ–º–∏

```python
# –ü—Ä–∏–∫–ª–∞–¥ –±—ñ–∑–Ω–µ—Å-–ø–∏—Ç–∞–Ω–Ω—è –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –∑—ñ—Ä—á–∞—Å—Ç–æ—ó —Å—Ö–µ–º–∏
result = fact_ratings \
    .join(dim_anime, on="Anime_SK") \
    .filter(col("Avg_Score") >= 8) \
    .groupBy("Type") \
    .count() \
    .orderBy("count", ascending=False)
result.show()
```

## üìù –î–æ–¥–∞—Ç–∫–æ–≤–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

- [DOCKER_USAGE.md](DOCKER_USAGE.md) - –¥–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Docker
- [GIT_FILES.md](GIT_FILES.md) - —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ñ–∞–π–ª–∏ –≤ Git

## üë• –ö–æ–º–∞–Ω–¥–∞

–ü—Ä–æ–µ–∫—Ç –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –∫–æ–º–∞–Ω–¥–æ—é –¥–ª—è –¥–∏—Å—Ü–∏–ø–ª—ñ–Ω–∏ "–ê–Ω–∞–ª—ñ–∑ –í–µ–ª–∏–∫–∏—Ö –¥–∞–Ω–∏—Ö".

## üìÑ –õ—ñ—Ü–µ–Ω–∑—ñ—è

–¶–µ–π –ø—Ä–æ–µ–∫—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è –Ω–∞–≤—á–∞–ª—å–Ω–∏—Ö —Ü—ñ–ª–µ–π.
